
<!-- README.md is generated from README.Rmd. Please edit that file -->

## Package Review

*Please check off boxes as applicable, and elaborate in comments below.
Your review is not limited to these topics, as described in the reviewer
guide*

-   **Briefly describe any working relationship you have (had) with the
    package authors.**
-   [x] As the reviewer I confirm that there are no [conflicts of
    interest](https://devguide.ropensci.org/policies.html#coi) for me to
    review this work (if you are unsure whether you are in conflict,
    please speak to your editor *before* starting your review).

#### Documentation

The package includes all the following forms of documentation:

-   [x] **A statement of need:** clearly stating problems the software
    is designed to solve and its target audience in README
-   [x] **Installation instructions:** for the development version of
    package and any non-standard dependencies in README
-   [x] **Vignette(s):** demonstrating major functionality that runs
    successfully locally
-   [x] **Function Documentation:** for all exported functions
-   [x] **Examples:** (that run successfully locally) for all exported
    functions
-   [x] **Community guidelines:** including contribution guidelines in
    the README or CONTRIBUTING, and DESCRIPTION with `URL`, `BugReports`
    and `Maintainer` (which may be autogenerated via `Authors@R`).

#### Functionality

-   [x] **Installation:** Installation succeeds as documented.
-   [x] **Functionality:** Any functional claims of the software been
    confirmed.
-   [x] **Performance:** Any performance claims of the software been
    confirmed.
-   [x] **Automated tests:** Unit tests cover essential functions of the
    package and a reasonable range of inputs and conditions. All tests
    pass on the local machine.
-   [x] **Packaging guidelines**: The package conforms to the rOpenSci
    packaging guidelines.

Estimated hours spent reviewing: 3h

-   [x] Should the author(s) deem it appropriate, I agree to be
    acknowledged as a package reviewer (“rev” role) in the package
    DESCRIPTION file.

------------------------------------------------------------------------

### Review Comments

Congratulations to the authors. Everything worked well. The comments I
wrote were mostly ideas that seems to be that could improve the user
experience, but the package looks great as it is. Nice testing suite!

#### README

-   In the README, the authors use an abbreviation (FAIR). It might be
    good to clarify what is about (Findability, Accessibility,
    Interoperability, and Reusability). Also, for readers that are not
    introduced to the concept of FAIR, what do you think about linking a
    texto to clarify it? Such as
    <https://www.nature.com/articles/sdata201618> or
    <https://www.go-fair.org/fair-principles/>

#### Vignette

-   In the
    [vignette](https://frictionlessdata.github.io/frictionless-r/articles/frictionless.html),
    the pipe from `magrittr` is used but it was not loaded. So if
    someone is trying to follow the code in the vignette, there is an
    `could not find function "%>%"` error.

-   Just for the record: When executing `library(frictionless)` there is
    a message saying that
    `The following object is masked from ‘package:usethis’: create_package`.

-   There is some examples that are shown using lists. What do the
    authors think about using functions instead, to be more
    standardized? Example: create a function `resources(package)` to use
    it instead of `package$resource_names`.

-   Adding the descriptions to the schema does not seem trivial. There
    is an example with `purrr` package. But the example might be not
    simple to understand if someone is not used to the `purrr` package.

I\`m talking about this piece of code:

``` r
iris_schema <- create_schema(iris)

# Remove description for first field
iris_schema$fields[[1]]$description <- NULL

# Set descriptions for all fields
descriptions <- c(
  "Sepal length in cm.",
  "Sepal width in cm.",
  "Pedal length in cm.",
  "Pedal width in cm.",
  "Iris species."
)
iris_schema$fields <- purrr::imap(
  iris_schema$fields,
  ~ c(.x, description = descriptions[.y])
)
```

Do the authors think that it is possible to create a function to add
descriptions to the schema, in a way that is used in a similar way as
the other functions of the package? Example of the idea:

``` r
iris_schema <- create_schema(iris) |>
  add_description(
    c(
      "Sepal length in cm.",
      "Sepal width in cm.",
      "Pedal length in cm.",
      "Pedal width in cm.",
      "Iris species."
    )
  )
```

-   The vignette says that in order to validate the Data Package, the
    users need to use Python. Is there any plans to implement that
    funcionality in R aswell?

> Validate your Data Package before depositing. You can do this in
> Python with the Frictionless Framework using frictionless validate
> datapackage.json.

-   In the vignette, there is some instructions to zip the csv to reduce
    size of the files:

> Zip the individual csv files (and update their paths in
> datapackage.json) to reduce size, not the entire Data Package. That
> way, users still have direct access to the datapackage.json file. See
> this example.

Do the authors think that is a good idea to add an argument on
`write_package()` to write the compressed csvs, to facilitate this step?
Something like:

``` r
write_package(my_package, "my_directory", compress = TRUE) 
```

[Since the function uses
`readr::write_csv()`](https://github.com/frictionlessdata/frictionless-r/blob/a446512da1ff00384f06064d3cdfab1d3ce2d29f/R/write_resource.R#L18),
if `compress = TRUE` it could add `.gz` at the end of the filepath and
readr would zip it on the fly.

Example:

``` r
readr::write_csv(mtcars, "mtcars.csv")
file.size("mtcars.csv")
#> [1] 1281

readr::write_csv(mtcars, "mtcars_zipped.csv.gz")
file.size("mtcars_zipped.csv.gz")
#> [1] 558
```

------------------------------------------------------------------------

Template from:
<https://github.com/ropensci-org/pkgreviewr/blob/master/inst/templates/review-index>

### session info

``` r
sessionInfo()
```

    R version 4.1.0 (2021-05-18)
    Platform: x86_64-apple-darwin17.0 (64-bit)
    Running under: macOS Big Sur 11.5.2

    Matrix products: default
    LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

    locale:
    [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

    attached base packages:
    [1] stats     graphics  grDevices utils     datasets  methods  
    [7] base     

    other attached packages:
    [1] magrittr_2.0.2 devtools_2.4.3 usethis_2.1.5 

    loaded via a namespace (and not attached):
     [1] xmlparsedata_1.0.5 compiler_4.1.0     pillar_1.6.5      
     [4] prettyunits_1.1.1  remotes_2.4.2      tools_4.1.0       
     [7] digest_0.6.29      testthat_3.1.2     pkgbuild_1.3.1    
    [10] pkgload_1.2.4      praise_1.0.0       jsonlite_1.7.3    
    [13] memoise_2.0.1      lifecycle_1.0.1    tibble_3.1.6      
    [16] pkgconfig_2.0.3    rlang_1.0.0        rex_1.2.1         
    [19] whoami_1.3.0       rstudioapi_0.13    cli_3.1.1         
    [22] curl_4.3.2         xfun_0.29          xopen_1.0.0       
    [25] cyclocomp_1.1.0    fastmap_1.1.0      knitr_1.37        
    [28] pkgreviewr_0.2.0   httr_1.4.2         xml2_1.3.3        
    [31] withr_2.4.3        desc_1.4.0         fs_1.5.2          
    [34] vctrs_0.3.8        hms_1.1.1          rprojroot_2.0.2   
    [37] glue_1.6.1         R6_2.5.1           processx_3.5.2    
    [40] fansi_1.0.2        rcmdcheck_1.4.0    sessioninfo_1.2.2 
    [43] lintr_2.0.1        callr_3.7.0        purrr_0.3.4       
    [46] readr_2.1.1        tzdb_0.2.0         covr_3.5.1        
    [49] ps_1.6.0           clisymbols_1.2.0   ellipsis_0.3.2    
    [52] goodpractice_1.0.2 utf8_1.2.2         lazyeval_0.2.2    
    [55] cachem_1.0.6       crayon_1.4.2       brio_1.1.3   

## Test installation

### test local `frictionless` install:

``` r
install(pkg_dir, dependencies = T, build_vignettes = T)
```

``` r
remove.packages("frictionless")
```

#### **comments:**

-   The local installation worked.

### test install of `frictionless` from GitHub with:

``` r
devtools::install_github("frictionlessdata/frictionless-r", dependencies = T, build_vignettes = T)
```

#### **comments:**

<!-- record comments on github install here -->

-   The installation from GitHub worked.

## Check package integrity

### run checks on `frictionless` source:

``` r
devtools::check(pkg_dir)
```

#### **comments:**

<!-- record comments on checks here -->

    ── R CMD check results ──────────────── frictionless 0.10.0.9000 ────
    Duration: 58.3s

    0 errors ✓ | 0 warnings ✓ | 0 notes ✓

### run tests on `frictionless` source:

``` r
devtools::test(pkg_dir)
```

#### **comments:**

<!-- record comments on tests here -->

    ℹ Loading frictionless
    Warning: package ‘testthat’ was built under R version 4.1.2
    ℹ Testing frictionless
    ✓ | F W S  OK | Context
    ✓ |        87 | add_resource [3.4s]                                  
    ✓ |        12 | check_package [0.7s]                                 
    ✓ |        17 | check_schema [0.6s]                                  
    ✓ |         2 | create_package                                       
    ✓ |         9 | create_schema [0.2s]                                 
    ✓ |        21 | read_package [0.8s]                                  
    ✓ |       120 | read_resource [8.0s]                                 
    ✓ |         6 | remove_resource [0.1s]                               
    ✓ |         8 | utils                                                
    ✓ |        60 | write_package [3.7s]                                 

    ══ Results ══════════════════════════════════════════════════════════
    Duration: 17.7 s

    [ FAIL 0 | WARN 0 | SKIP 0 | PASS 342 ]

### check `frictionless` for goodpractice:

``` r
goodpractice::gp(pkg_dir)
```

#### **comments:**

<!-- record comments on goodpractice here -->

-   The results for goodpractice is:
    -   use `<-` instead of `=`:
        -   line 141 of `add_resource.R`
    -   avoid long code lines:
        -   lines 57, 58, 136, of `add_resource.R`
        -   lines 48 of `check_package.R`
        -   lines 50, 56, 118, 147, 154 of `read_resource.R`

## Check package metadata files

### inspect

-   #### [README](https://github.com/frictionlessdata/frictionless-r)

-   #### [DESCRIPTION](https://github.com/frictionlessdata/frictionless-r/blob/master/DESCRIPTION)

-   #### [NAMESPACE](https://github.com/frictionlessdata/frictionless-r/blob/master/NAMESPACE)

### spell check

``` r
devtools::spell_check(pkg_dir)
```

#### **comments:**

<!-- record comments on metadata files here -->

ok!

## Check documentation

online documentation:
**<https://frictionlessdata.github.io/frictionless-r/>**

-   Is the
    [documentation](https://ropensci.github.io/dev_guide/building.html#documentation)
    (installation instructions/vignettes/examples/demos) clear and
    sufficient?

### test `frictionless` function help files:

``` r
help(package = "frictionless")
```

#### **comments:**

<!-- record comments on help files here -->

Yes!

### test `frictionless` vignettes:

``` r
vignette(package = "frictionless")
```

#### **comments:**

<!-- record comments on vignettes here -->

Comments in the resumed version.

## Test functionality:

-   Are there **user interface improvements** that could be made?
-   Are there **performance improvements** that could be made?

``` r
library("frictionless")
```

``` r
exports <-ls("package:frictionless")
exports
```

<!-- experiment with package functions -->

-   Experimenting with the package: it all worked!

``` r
# Create a data package
mananciais_data_package <- frictionless::create_package()


# Add a dataset in the data package
mananciais_data_package <-
  frictionless::add_resource(mananciais_data_package,
                             resource_name = "mananciais",
                             data = mananciais::mananciais)

# see the name of resources in the data package
mananciais_data_package$resource_names
# [1] "mananciais"

# write the package
frictionless::write_package(mananciais_data_package, "mananciais_data_package")

list.files("mananciais_data_package")
# [1] "datapackage.json" "mananciais.csv"  
```

#### **comments:**

<!-- record comments on package experimentation here -->

------------------------------------------------------------------------

Comments in the resumed version.

## Review test suite:

See guidance on
[testing](https://ropensci.github.io/dev_guide/building.html#testing)
for further details.

### test coverage

``` r
covr::package_coverage(pkg_dir)
```

    frictionless Coverage: 100.00%
    R/add_resource.R: 100.00%
    R/check_package.R: 100.00%
    R/check_schema.R: 100.00%
    R/create_package.R: 100.00%
    R/create_schema.R: 100.00%
    R/get_resource.R: 100.00%
    R/get_schema.R: 100.00%
    R/read_package.R: 100.00%
    R/read_resource.R: 100.00%
    R/remove_resource.R: 100.00%
    R/utils.R: 100.00%
    R/write_package.R: 100.00%
    R/write_resource.R: 100.00%

### inspect [tests](https://github.com/frictionlessdata/frictionless-r/blob/master/tests/testthat)

#### **comments:**

<!-- record comments on testing suite here -->

The package has extensive testing suite. Congratulations.
