---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(magrittr)
library(devtools)
```

# `qualR` - package review

## **Reviewer:** [\@beatrizmilz](https://github.com/beatrizmilz)

### Review Submitted: ....

## Package Review

*Please check off boxes as applicable, and elaborate in comments below.  Your review is not limited to these topics, as described in the reviewer guide*

- **Briefly describe any working relationship you have (had) with the package authors.**

- [x] As the reviewer I confirm that there are no [conflicts of interest](https://devguide.ropensci.org/policies.html#coi) for me to review this work (if you are unsure whether you are in conflict, please speak to your editor _before_ starting your review).

#### Documentation

The package includes all the following forms of documentation:

- [x] **A statement of need:** clearly stating problems the software is designed to solve and its target audience in README
- [x] **Installation instructions:** for the development version of package and any non-standard dependencies in README
- [x] **Vignette(s):** demonstrating major functionality that runs successfully locally
- [x] **Function Documentation:** for all exported functions
- [x] **Examples:** (that run successfully locally) for all exported functions
- [x] **Community guidelines:** including contribution guidelines in the README or CONTRIBUTING, and DESCRIPTION with `URL`, `BugReports` and `Maintainer` (which may be autogenerated via `Authors@R`).

#### Functionality

- [x] **Installation:** Installation succeeds as documented.
- [x] **Functionality:** Any functional claims of the software been confirmed.
- [x] **Performance:** Any performance claims of the software been confirmed.
- [ ] **Automated tests:** Unit tests cover essential functions of the package and a reasonable range of inputs and conditions. All tests pass on the local machine.
- [ ] **Packaging guidelines**: The package conforms to the rOpenSci packaging guidelines.

Estimated hours spent reviewing: 6h

- [x] Should the author(s) deem it appropriate, I agree to be acknowledged as a package reviewer ("rev" role) in the package DESCRIPTION file.

---

### Review Comments

Congratulations for this package!
I wrote more extensive comments in the [full report](https://github.com/beatrizmilz/ropensci_reviews/blob/main/review-qualR/README.md), made with `ropensci-org/pkgreviewr`. 

Here are some key points that would be interested to work on, in order to improve the package:

- Consistent naming styles: it would be better to choose a language (English), and a coding style (ex. snake case) and use them in all function names, arguments, and name of columns in the datasets returned.

- The tests can be improved. Consider also using GitHub Actions to perform a automated check.

- Files in the root directory: some of the files does not seems fit to be stored there (such as the files related to the paper), and some needs to be ignored in the build of the package. I wrote in more detail in the report. 

- The spell check found some typos that could be corrected.

- I wrote in the report some ideas for the vignettes, but they are only suggestions to make it easier for people to use the data. 

- Modifing directories using `set.wd()` is not something recommended in the book R Packages ( https://r-pkgs.org/r.html )

Report: https://github.com/beatrizmilz/ropensci_reviews/blob/main/review-qualR/README.md


 
----

## REPORT


<br>

This report contains documents associated with the review of **rOpenSci** submitted package:

### **`qualR`: ropensci/software-review**  issue [\#474](https://github.com/ropensci/software-review/issues/474).

<br>

## Package info

**Description:**

A package to download information from CETESB QUALAR and
    MonitorAr systems. It contains function to download different parameters, a set of
    criteria pollutants and the most frequent meteorological parameters used in
    air quality data analysis and air quality model evaluation.

**Author:** `r c(
    person(given = "Mario",
           family = "Gavidia-Calderón",
           role = c("aut", "cre"),
           email = "mario.calderon@iag.usp.br",
           comment = c(ORCID = "0000-0002-7371-1116")),
    person(given = "Maria de Fatima",
           family = "Andrade",
           role = c("ctb", "ths"),
           email = "maria.andrade@iag.usp.br",
           comment = c(ORCID = "0000-0001-5351-8311")),
    person(given = "Daniel",
           family = "Schuch",
           role = c("aut","ctb"),
           email = "d.schuch@northeastern.edu",
           comment = c(ORCID = "0000-0001-5977-4519")))`

**repo url:** <https://github.com/quishqa/qualR>

**website url:** <https://quishqa.github.io/qualR/>





## Review info


#### See [reviewer guidelines](https://ropensci.github.io/dev_guide/reviewerguide.html) for further information on the rOpenSci review process.

**key review checks:**

- Does the code comply with **general principles in the [Mozilla reviewing guide](https://mozillascience.github.io/codeReview/review.html)**?
- Does the package **comply with the [ROpenSci packaging guide](https://ropensci.github.io/dev_guide/building.html)**?
- Are there **improvements** that could be made to the **code style?**
- Is there **code duplication** in the package that should be reduced?
- Are there **user interface improvements** that could be made?
- Are there **performance improvements** that could be made?
- Is the [**documentation**](https://ropensci.github.io/dev_guide/building.html#documentation) (installation instructions/vignettes/examples/demos) **clear and sufficient**?

Please be respectful and kind to the authors in your reviews. The rOpenSci [code of conduct](https://ropensci.github.io/dev_guide/policies.html#code-of-conduct) is mandatory for everyone involved in our review process.



### session info


```{r sessionInfo, echo=TRUE}
sessionInfo()
```


```{r pkg_dir, echo=TRUE}
pkg_dir <- "/home/bea/GitHub/ropensci_reviews/qualR"
pkg_dir
```

## Test installation

### test local `qualR` install:

```{r test-local, eval=FALSE, include=TRUE}
install(pkg_dir, dependencies = T, build_vignettes = T)
```

```{r github-rm, eval=FALSE, include=TRUE}
remove.packages("qualR")
```


#### **comments:**

The local installation worked. ✨

***

### test install of `qualR` from GitHub with:

```{r test-github, eval=FALSE, include=TRUE}
devtools::install_github("quishqa/qualR", dependencies = T, build_vignettes = T)
```

#### **comments:**

 The installation via GitHub worked. ✨


## Check package integrity

### run checks on `qualR` source:

```{r check-checks, eval=FALSE, include=TRUE}
devtools::check(pkg_dir)
```


**Check results:** 

```
── R CMD check results ─────────────────────────────── qualR 0.9.5 ────
Duration: 1m 54s

> checking R/sysdata.rda ... OK
   WARNING
  ‘qpdf’ is needed for checks on size reduction of PDFs

> checking top-level files ... NOTE
  Non-standard files/directories found at top level:
    ‘CONTRIBUTING.md’ ‘LICENSE.md’ ‘README.Rmd’ ‘_pkgdown.yml’
    ‘appveyor.yml’ ‘codecov.yml’ ‘codemeta.json’ ‘data-raw’ ‘docs’
    ‘paper.bib’ ‘paper.md’ ‘pin_nox_lock20.png’ ‘rj_centro_2019.png’
    ‘usp_o3_aug21.png’

0 errors ✓ | 1 warning x | 1 note x
```


#### **comments:**

The check returned 1 note and 1 warning.

About the warning:

The warning of qpdf is related to an external program. In this Stackoverflow answer there is an explanation for it: https://stackoverflow.com/a/44649267


About the note:

There are some files that are not needed to the package be build, so it needs to be ignored on `.Rbuildignore` . One way to do that is to use `usethis::use_build_ignore("relative_path_to_the_file")`. But I do not recommend to use this function to all the files that the Check listed. There are some files that would be better located in other directories, not in the root of the package (such as the images and the files related to the paper being written about the package).  In this link, there is more information about the `.Rbuildignore` file: https://r-pkgs.org/package-structure-state.html#rbuildignore  

Ex:

```
> usethis::use_build_ignore("CONTRIBUTING.md")
✓ Setting active project to '/home/bea/GitHub/ropensci_reviews/qualR'
✓ Adding '^CONTRIBUTING\\.md$' to '.Rbuildignore'
```

***

### run tests on `qualR` source:

```{r check-tests, eval=FALSE, include=TRUE}
devtools::test(pkg_dir)
```


**Tests results:** 

```
══ Results ════════════════════════════════════════════════════════════
Duration: 71.1 s

[ FAIL 0 | WARN 0 | SKIP 0 | PASS 8 ]
```


#### **comments:**

I wrote comments about the tests in the test section.



***


### check `qualR` for goodpractice:



```{r test-goodpractice, eval=FALSE, include=TRUE}
goodpractice::gp(pkg_dir)
```

```
── GP qualR ───────────────────────────────────────────────────────────

It is good practice to

  ✖ avoid calling setwd(), it changes the global
    environment. If you need it, consider using on.exit() to
    restore the working directory.

    tests/testthat/test-CetesbRetrieveParam.R:4:11
    tests/testthat/test-CetesbRetrieveParam.R:9:3
    tests/testthat/test-MonitorArRetrieve.R:4:11
    tests/testthat/test-MonitorArRetrieve.R:7:3

  ✖ fix this R CMD check NOTE: Note: found 40 marked
    UTF-8 strings
  ✖ fix this R CMD check WARNING: LaTeX errors when
    creating PDF version. This typically indicates Rd
    problems.
  ✖ fix this R CMD check ERROR: Re-running with no
    redirection of stdout/stderr. Hmm ... looks like a package
    Warning in texi2dvi(file = file, pdf = TRUE, clean =
    clean, quiet = quiet, : texi2dvi script/program not
    available, using emulation Error in texi2dvi(file = file,
    pdf = TRUE, clean = clean, quiet = quiet, : pdflatex is
    not available Warning in texi2dvi(file = file, pdf = TRUE,
    clean = clean, quiet = quiet, : texi2dvi script/program
    not available, using emulation Error in texi2dvi(file =
    file, pdf = TRUE, clean = clean, quiet = quiet, : pdflatex
    is not available Error in running tools::texi2pdf() You
    may want to clean up by 'rm -Rf
    /tmp/RtmpNm3vzd/Rd2pdf3bab53f279cd'
```




#### **comments:**

I recommend that the authors check if the `setwd()` is really necessary. The r-pkgs.org book says that `setwd()` should be used with caution. [Reference](https://r-pkgs.org/r.html#code-r-landscape).

***

## Check package metadata files

### inspect

- #### [README](https://github.com/quishqa/qualR)


- #### [DESCRIPTION](https://github.com/quishqa/qualR/blob/master/DESCRIPTION)


- #### [NAMESPACE](https://github.com/quishqa/qualR/blob/master/NAMESPACE)



### spell check

```{r spell-check, eval=FALSE, include=TRUE}
devtools::spell_check(pkg_dir)
```

**Spell check results***
```
> devtools::spell_check(pkg_dir)
DESCRIPTION does not contain 'Language' field. Defaulting to 'en-US'.
  WORD                     FOUND IN
à                       README.md:383
anf                      NEWS.md:24
Aperfeiçoamento         README.md:383
AppVeyor                 README.md:2
                         README.Rmd:20
AQS                      cetesb_aqs.Rd:6,10,11,12,13,20,21,22
                         CetesbRetrieve.Rd:25,39,40
                         CetesbRetrieveMet.Rd:22,38
                         CetesbRetrieveMetPol.Rd:22,40
                         CetesbRetrieveParam.Rd:26,42
                         CetesbRetrievePol.Rd:22,38
                         monitor_ar_aqs.Rd:6,10,11,12,13,14,16,24
                         MonitorArRetrieveMet.Rd:21,35
                         MonitorArRetrieveMetPol.Rd:21,37
                         MonitorArRetrieveParam.Rd:22
                         MonitorArRetrievePol.Rd:21,35
                         README.md:30,31,32,33,35,36,37,48,71,73,97,122,124,146,148,169,195,226,228,254,256,268,269,301,327,329,345
                         README.Rmd:38
                         qualr.Rmd:40,41,42,43,45,46,47
Centro                   qualr.Rmd:65
CETESB                   cetesb_aqs.Rd:6,10,11,12,13,20
                         cetesb_param.Rd:6,10,12,19
                         CetesbRetrieve.Rd:5,19,21,40
                         CetesbRetrieveMet.Rd:5,18,20,38
                         CetesbRetrieveMetPol.Rd:5,18,20
                         CetesbRetrieveParam.Rd:5,19,21
                         CetesbRetrievePol.Rd:5,18,20,38
                         description:1
                         README.md:6,30,31,32,33,44,44,69,148,226,228,367,369,374,381
                         README.Rmd:24
                         qualr.Rmd:23,40,41,42,43,113
CetesbRetrieveParam      cetesb_aqs.Rd:21
Científico              README.md:383
CNPq                     README.md:383
Conselho                 README.md:383
Coordenadoria            README.md:383
csv                      CetesbRetrieve.Rd:33
                         CetesbRetrieveMet.Rd:30
                         CetesbRetrieveMetPol.Rd:30
                         CetesbRetrieveParam.Rd:34
                         CetesbRetrievePol.Rd:30
                         MonitorArRetrieveMet.Rd:27
                         MonitorArRetrieveMetPol.Rd:27
                         MonitorArRetrieveParam.Rd:31
                         MonitorArRetrievePol.Rd:27
                         README.md:200
de                       MonitorArRetrieveParam.Rd:38
                         title:1
                         NEWS.md:8
                         README.md:1,5,383
                         qualr.Rmd:21,32,51,53,119
Desenvolvimento          README.md:383
emptor                   README.md:365
EPSG                     monitor_ar_aqs.Rd:15,17
Estação                qualr.Rmd:65
Estado                   README.md:383
FAPESP                   README.md:383
funcion                  NEWS.md:21,22,23,24
Fundação               README.md:383
hPa                      CetesbRetrieveMetPol.Rd:34
                         MonitorArRetrieveMetPol.Rd:31
                         README.md:148
IAG                      README.md:385
Ibirapuera               README.md:195
Ipen                     qualr.Rmd:119
Iraja                    README.md:329
Janeiro                  MonitorArRetrieveParam.Rd:38
                         title:1
                         NEWS.md:8
                         README.md:1,5
                         qualr.Rmd:32,51,53
Janerio                  qualr.Rmd:21
LAPAT                    README.md:385
lontgitude               cetesb_aqs.Rd:13
meterorological          MonitorArRetrieveMet.Rd:34
MonitorAr                monitor_ar_aqs.Rd:10,11,12,13,14,16
                         monitor_ar_param.Rd:10,11
                         MonitorArRetrieveParam.Rd:5,38
                         description:2
                         README.md:6,34,35,36,37,44,325,376,381
                         qualr.Rmd:44,45,46,47
MonitorArRetrieveParam   monitor_ar_aqs.Rd:26
                         monitor_ar_param.Rd:20
Nacional                 README.md:383
Nível                   README.md:383
NOx                      CetesbRetrieveMetPol.Rd:35
                         CetesbRetrievePol.Rd:34
                         MonitorArRetrieveMetPol.Rd:32
                         MonitorArRetrievePol.Rd:30
openair                  README.md:41
                         qualr.Rmd:105
paramater                cetesb_param.Rd:10
paramenters              MonitorArRetrieveMet.Rd:34
                         README.md:347
Paremeters               MonitorArRetrieveParam.Rd:24
Paulo                    title:1
                         README.md:1,5,44,373,383
                         README.Rmd:23
                         qualr.Rmd:21,32,111,119
Pesquisa                 README.md:383
Pessoal                  README.md:383
Pinheiros                README.md:48,73,97,124,148
                         README.Rmd:38
pollutatns               MonitorArRetrieveMetPol.Rd:36
POSIXct                  README.md:40
ppb                      CetesbRetrievePol.Rd:34
                         README.md:124
preprocessor             qualr.Rmd:21
QUALAR                   cetesb_aqs.Rd:11,20
                         cetesb_param.Rd:10,12,19
                         CetesbRetrieve.Rd:5,19,21
                         CetesbRetrieveMet.Rd:5,18,20
                         CetesbRetrieveMetPol.Rd:5,18,20
                         CetesbRetrieveParam.Rd:5,19,21
                         CetesbRetrievePol.Rd:5,18,20
                         description:1
                         README.md:6,30,31,32,33,44,44,367,369
                         README.Rmd:24
                         qualr.Rmd:21,23,40,41,42,43,113
qualitty                 cetesb_aqs.Rd:20
README                   qualr.Rmd:112,143
reproducibility          README.md:9
rio                      qualr.Rmd:28
safetly                  qualr.Rmd:112
Sao                      title:1
                         README.md:5,44,373
                         README.Rmd:23
São                     README.md:1,383
                         qualr.Rmd:21,32,111,119
SIRGAS                   monitor_ar_aqs.Rd:14,16
SSL                      NEWS.md:14
subaward                 README.md:383
Tecnológico             README.md:383
Temperatur               MonitorArRetrieveMet.Rd:30
th                       README.md:73
                         README.Rmd:38
ug                       CetesbRetrievePol.Rd:34
Universidade             README.md:383
                         qualr.Rmd:119
usally                   README.Rmd:23
usefull                  README.Rmd:82
Wellcome                 README.md:383
wth                      CetesbRetrieveMet.Rd:33
                         CetesbRetrievePol.Rd:33
yyyy                     CetesbRetrieve.Rd:27,29
                         CetesbRetrieveMet.Rd:24,26
                         CetesbRetrieveMetPol.Rd:24,26
                         CetesbRetrieveParam.Rd:28,30
                         CetesbRetrievePol.Rd:24,26
                         MonitorArRetrieveMet.Rd:17,19
                         MonitorArRetrieveMetPol.Rd:17,19
                         MonitorArRetrieveParam.Rd:18,20
                         MonitorArRetrievePol.Rd:17,19
μg                      README.md:124
```

#### **comments:**

<!-- record comments on metadata files here -->

- **spell check**: some are words in Portuguese, and some appears to be typos (Wellcome , usally, qualitty, pollutatns   ...)

##### README

[Reference](https://devguide.ropensci.org/building.html#readme)

- Please review the bagdes in the README.
    - There is two badges, the one for Travis has a broken link (404).
    - Add rOpenSci Review badge:   [![](https://badges.ropensci.org/474_status.svg)](https://github.com/ropensci/software-review/issues/474)

```
[![](https://badges.ropensci.org/474_status.svg)](https://github.com/ropensci/software-review/issues/474)
```

- Code of conduct: in the book, is recommended to use a code of conduct (CoC), and I did not find that information in the README. You can create that using `usethis`. But it is important to read this link:   https://devguide.ropensci.org/collaboration.html#coc-file  which says that if the package is transfered to rOpenSci GitHub organization, the CoC that needs to be used is the CoC that ropensci uses.  

```
> usethis::use_code_of_conduct("mario.calderon@iag.usp.br")
✓ Setting active project to '/home/bea/GitHub/ropensci_reviews/qualR'
✓ Writing 'CODE_OF_CONDUCT.md'
✓ Adding '^CODE_OF_CONDUCT\\.md$' to '.Rbuildignore'
Warning: pkgdown config does not specify the site's url, which is optional but recommended
• Don't forget to describe the code of conduct in your README:
  ## Code of Conduct
  
  Please note that the qualR project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
```

##### CITATION file

The CITATION file exists. There are releases on GitHUb,  but I did not find any reference to  Zenodo.  [Reference](https://devguide.ropensci.org/building.html#citation-file). There is 0 results searching for qualR on Zenodo: https://zenodo.org/search?page=1&size=20&q=qualR . Read more how to do it and have a DOI for your package on [the GitHub documentation](https://docs.github.com/en/repositories/archiving-a-github-repository/referencing-and-citing-content).

***

## Check documentation

online documentation: **<https://quishqa.github.io/qualR/>**

* Is the [documentation](https://ropensci.github.io/dev_guide/building.html#documentation) (installation instructions/vignettes/examples/demos) clear and sufficient?

### test `qualR` function help files:

```{r test-help, eval=FALSE, include=TRUE}
help(package = "qualR")
```

#### **comments:**

<!-- record comments on help files here -->

In general, yes. I wrote some notes about the vignettes in the next section.

The file `R/sysdata.rda` is storing some datasets of the package. Accordingly to [r-pkgs](https://r-pkgs.org/data.html?q=r/#data-sysdata), `R/sysdata.rda` should be used to internal datasets. Since the datasets are meant to be used by the users (some of them are on the README), it would be good to check if all the datasets that are meant to be used by the users are stored in the `data/` directory . 

To store the dataset in `data/`, you can use:

```
> usethis::use_data(cetesb)
✓ Saving 'cetesb' to 'data/cetesb.rda'
• Document your data (see 'https://r-pkgs.org/data.html')
```

***

### test `qualR` vignettes:

```{r test-vignettes, eval=FALSE, include=TRUE}
vignette(package = "qualR")
```

#### **comments:**

<!-- record comments on vignettes here -->

- There is one vignette. Since part of the vignette is about using the data from Rio de Janeiro and the other is from Sao Paulo, I think its a good idea to split into two vignettes.

- Please review the links in the vignette, there is broken links (such as `[CETESB QUALAR System]()`,  `[data.rio]()`).

- The package `ggplot2` is a great package to create graphs in R. I think it would be great to have an vignette with an example to use the data retrieved with qualR with `ggplot2`. I experimented the code in the vignette and made a similar graph with `ggplot2`:


```{r qualR-ggplot2-example, cache = TRUE, warning = FALSE, dpi = 300}
library(qualR)
library(magrittr)
library(ggplot2)

rj_ca_params <- MonitorArRetrieveParam(start_date = "01/01/2019",
                                    end_date = "31/12/2019",
                                    aqs_code = "CA",
                                    parameters = c("PM10", "Vel_Vento"))

rj_ca_params %>% 
  ggplot() +
  geom_point(aes(x = Vel_Vento, y = PM10), size = 0.5,  alpha = 0.5) +
  labs(x = "Wind speed (m/s)",
       y = expression(PM[10]~" ("*mu*"g/m"^3*")"),
       caption = "Source: Data from MonitorAr - Rio, retrieved with the R package qualR. ",
       title = "Estação Centro - Rio de Janeiro"
       )+
  theme_bw()

```


- Other thing that would be nice would be examples of how to search for data from more than one station at once (and can be used with `ggplot2`'s facets). Ex:


```{r qualR-ggplot2-example-facet, cache = TRUE, warning = FALSE, dpi = 600}
library(ggplot2)
library(qualR)

# retrieve data from all stations in Rio
rj_params <- purrr::map_dfr(.x = qualR::monitor_ar_aqs$code, 
                            .f = MonitorArRetrieveParam,
                            start_date = "01/01/2020",
                            end_date = "31/12/2020",
                            parameters = c("PM10", "Vel_Vento")
                            )


# making the graph with facet
rj_params %>% 
  ggplot() +
  geom_point(aes(x = Vel_Vento, y = PM10), size = 0.5,  alpha = 0.5) +
  labs(x = "Wind speed (m/s)",
       y = expression(PM[10]~" ("*mu*"g/m"^3*")"),
       caption = "Source: Data from MonitorAr - Rio, retrieved with the R package qualR. "
       )+
  theme_bw()+
  facet_wrap(~aqs)
```




- In the section 'Compatibility with `openair`': I do not have `openair` installed prior this review, and it is not a dependency of qualR. So I think it would be a good idea to write in the vignette, before you use `openair`, the code to install the package (with #) and load it:

```{r vignette-openair, echo=TRUE}
# install.packages("openair")
library(openair)
```


***

## Test functionality:

- Are there **user interface improvements** that could be made?
- Are there **performance improvements** that could be made?

```{r free-style, eval=FALSE, include=TRUE}
library("qualR")
```

```{r parse-functions, eval=FALSE, include=TRUE}
exports <- ls("package:qualR")
exports
```

<!-- experiment with package functions -->

```{r exp-chunk, eval=FALSE, include=TRUE}

# EXPERIMENTING WITH RJ DATA ----------------------


rj_pol_ca <- MonitorArRetrievePol(start_date = "01/01/2021",
                                    end_date = "23/11/2021",
                                    aqs_code = "CA")

dplyr::glimpse(rj_pol_ca)

# Rows: 7,824
# Columns: 9
# $ date <dttm> 2020-12-31 21:30:00, 2020-12-31 22:30:00, 2020-12-31 23…
# $ o3   <dbl> 42.50, 39.18, 31.45, 19.69, 10.36, 12.95, 17.27, 23.46, …
# $ no   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ no2  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ nox  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ co   <dbl> 0.38, 0.39, 0.41, 0.66, 0.86, 0.71, 0.54, 0.52, 0.53, 0.…
# $ pm10 <dbl> 33, 40, 37, 30, 60, 78, 63, 51, 47, 47, 35, 18, 28, 24, …
# $ pm25 <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ aqs  <chr> "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA", "C…


  
rj_met_ca <- MonitorArRetrieveMet(start_date = "01/01/2021",
                                    end_date = "23/11/2021",
                                    aqs_code = "CA")



dplyr::glimpse(rj_met_ca)

# Rows: 7,824
# Columns: 7
# $ date <dttm> 2020-12-31 21:30:00, 2020-12-31 22:30:00, 2020-12-31 23…
# $ tc   <dbl> 26.55, 26.18, 26.02, 26.07, 26.08, 26.12, 26.63, 27.60, …
# $ rh   <dbl> 87.88, 91.00, 91.28, 92.10, 92.05, 93.00, 91.42, 87.32, …
# $ ws   <dbl> 0.83, 0.70, 0.90, 0.60, 0.53, 0.80, 0.33, 0.70, 0.60, 1.…
# $ wd   <dbl> 215.00, 109.00, 108.83, 157.67, 153.17, 138.67, 130.17, …
# $ p    <dbl> 1011.30, 1010.63, 1010.15, 1009.92, 1010.12, 1010.72, 10…
# $ aqs  <chr> "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA", "C…


rj_param_ca <-
  MonitorArRetrieveParam(
    start_date = "01/01/2021",
    end_date = "23/11/2021",
    aqs_code = "CA",
    parameters = qualR::monitor_ar_param$code
  )

dplyr::glimpse(rj_param_ca)
# 
# Rows: 7,824
# Columns: 20
# $ date      <dttm> 2020-12-31 21:30:00, 2020-12-31 22:30:00, 2020-12-…
# $ SO2       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ NO2       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ NO        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ NOx       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ HCNM      <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ HCT       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ CH4       <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ CO        <dbl> 0.38, 0.39, 0.41, 0.66, 0.86, 0.71, 0.54, 0.52, 0.5…
# $ O3        <dbl> 42.50, 39.18, 31.45, 19.69, 10.36, 12.95, 17.27, 23…
# $ PM10      <dbl> 33, 40, 37, 30, 60, 78, 63, 51, 47, 47, 35, 18, 28,…
# $ PM2_5     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ Chuva     <dbl> 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0…
# $ Pres      <dbl> 1011.30, 1010.63, 1010.15, 1009.92, 1010.12, 1010.7…
# $ RS        <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 6.50, 63.67, 102.50, …
# $ Temp      <dbl> 26.55, 26.18, 26.02, 26.07, 26.08, 26.12, 26.63, 27…
# $ UR        <dbl> 87.88, 91.00, 91.28, 92.10, 92.05, 93.00, 91.42, 87…
# $ Dir_Vento <dbl> 215.00, 109.00, 108.83, 157.67, 153.17, 138.67, 130…
# $ Vel_Vento <dbl> 0.83, 0.70, 0.90, 0.60, 0.53, 0.80, 0.33, 0.70, 0.6…
# $ aqs       <chr> "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA", "CA…


# EXPERIMENTING WITH SP DATA ----------------------

my_user <- "examplequalr@gmail.com"
my_password <- "06660666"



sp_diadema_met <- CetesbRetrieveMetPol(
  start_date = "01/01/2021",
  end_date = "23/11/2021",
  aqs_code = 92,
  username = my_user,
  password = my_password
)

dplyr::glimpse(sp_diadema_met)

# > dplyr::glimpse(sp_diadema_met)
# Rows: 7,849
# Columns: 14
# $ date <dttm> 2021-01-01 00:00:00, 2021-01-01 01:00:00, 2021-01-01 02…
# $ tc   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ rh   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ ws   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ wd   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ p    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ o3   <dbl> NA, 26, 28, 25, 29, 31, NA, 36, 37, 42, 47, 53, 58, 70, …
# $ no   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ no2  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ nox  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ co   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ pm10 <dbl> NA, 24, 50, 36, 18, 18, 13, 7, 8, 7, 4, 7, 10, 3, 11, 1,…
# $ pm25 <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
# $ aqs  <chr> "Diadema", "Diadema", "Diadema", "Diadema", "Diadema", "…

sp_diadema_params <- CetesbRetrieveParam(
  parameters = cetesb_param$code,
  start_date = "01/01/2021",
  end_date = "23/11/2021",
  aqs_code = 92,
  username = my_user,
  password = my_password
)


dplyr::glimpse(sp_diadema_params)

# Rows: 7,849
# Columns: 22
# $ date  <dttm> 2021-01-01 00:00:00, 2021-01-01 01:00:00, 2021-01-01 0…
# $ aqs   <chr> "Diadema", "Diadema", "Diadema", "Diadema", "Diadema", …
# $ ben   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ co    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ wd    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ dvg   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ ert   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ hcnm  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ pm10  <dbl> NA, 24, 50, 36, 18, 18, 13, 7, 8, 7, 4, 7, 10, 3, 11, 1…
# $ pm25  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ no    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ no2   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ nox   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ o3    <dbl> NA, 26, 28, 25, 29, 31, NA, 36, 37, 42, 47, 53, 58, 70,…
# $ press <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ radg  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ raduv <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ so2   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ tc    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ tol   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ rh    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ ws    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
```



```{r exp-chunk-more-aqs, eval=FALSE, include=TRUE}
# Test using more than one aqs codes.
rj_params <- MonitorArRetrieveParam(start_date = "01/01/2021",
                                    end_date = "23/11/2021",
                                    aqs_code = qualR::monitor_ar_aqs$code,
                                    parameters = c("PM10", "Vel_Vento"))

# Error in vapply(elements, encode, character(1)) : 
#   valores devem ser de comprimento 1,
#  mas o resultado de FUN(X[[1]]) tem comprimento 8
```


#### **comments:**

<!-- record comments on package experimentation here -->

- `MonitorArRetrievePol()`, `MonitorArRetrieveMet()` and `CetesbRetrieveMetPol()` - The names of the columns  of the dataset returned  are in a good pattern (all in English and snake case). The column classes I think it would be better if the numeric variables (such as the air parameters) returned numeric/double (now some of them are `lgl` because there is only NA's). 

- `MonitorArRetrieveParam()` - The names of the columns of the dataset returned are not in a good pattern, there is columns in English and others in Portuguese (Vel_Vento) and does not follow a consistent naming style. 

- There are functions that return similar datasets, only with more columns. It's not clear to me why is needed two different functions, instead of one function with more arguments to define what is the change  (such as  `CetesbRetrieveParam()` and `CetesbRetrieveMetPol()`).


- The names of the columns of the datasets generated by qualR are not following a style guide. I think it would be good to choose a naming style and use it across all the names of functions, name of arguments, and column names. 


- Console messages - It is not recommended to use `cat()` to communicate with the user of the functions. [Reference](https://devguide.ropensci.org/building.html#console-messages)


- IDEA - When the function is storing the csv with `to_csv = TRUE`, it would be nice to have an argument to write the path where the csv will be saved.


- IDEA - I think it would be nice to be able to search more than one station in the functions. 

***

## Inspect code:

- Does the package **comply with the [ROpenSci packaging guide](https://ropensci.github.io/dev_guide/building.html)**?


- good [function & variable naming?](https://ropensci.github.io/dev_guide/building.html#function-and-argument-naming) 
   
    
- good [dependency management](https://ropensci.github.io/dev_guide/building.html#package-dependencies)?
    

- Are there **improvements** that could be made to the [**code style?**](https://ropensci.github.io/dev_guide/building.html#code-style)


- Is there **code duplication** in the package that should be reduced?

```{r inspect-code, eval=FALSE, include=TRUE}
pkgreviewr::pkgreview_print_source("qualR")
```
**\* might not be suitable for large packages with many exported functions**


<br>
<br>

#### **comments:**

<!-- record comments on package source code here -->

 
Is recommended to choose a package names in lower case. [Reference](https://devguide.ropensci.org/building.html)

```{r pkg_name_available, eval=FALSE, include=TRUE}
available::available("qualR")
```

```
── qualR ──────────────────────────────────────────────────────────────
Name valid: ✔
Available on CRAN: ✔ 
Available on Bioconductor: ✔
Available on GitHub:  ✖ 
Abbreviations: http://www.abbreviations.com/qual
Wikipedia: https://en.wikipedia.org/wiki/qual
Wiktionary: https://en.wiktionary.org/wiki/qual
Urban Dictionary:
  [short] for [quality]
  http://qual.urbanup.com/410044
Sentiment:???
```

The name is available on CRAN! ⭐

It is also recommended to use snake case for function names.  [Reference](https://devguide.ropensci.org/building.html#function-and-argument-naming). The naming styles are inconsistent (the function names uses a style, the argument other, ), and this guide can help you with that: https://style.tidyverse.org/ . 


## Review test suite:

See guidance on [testing](https://ropensci.github.io/dev_guide/building.html#testing) for further details.

### test coverage

```{r pkg_coverage, eval=FALSE, include=TRUE}
covr::package_coverage(pkg_dir)

```
**covr results**

```
qualR Coverage: 95.93%
R/CheckCetesbCode.R: 75.00%
R/CetesbRetrieveParam.R: 85.37%
R/MonitorArRetrieveParam.R: 92.59%
R/CetesbRetrieve.R: 93.94%
R/CetesbRetrieveMet.R: 100.00%
R/CetesbRetrieveMetPol.R: 100.00%
R/CetesbRetrievePol.R: 100.00%
R/MonitorArRetrieveMet.R: 100.00%
R/MonitorArRetrieveMetPol.R: 100.00%
R/MonitorArRetrievePol.R: 100.00%
R/WriteCSV.R: 100.00%
```


### inspect [tests](https://github.com/quishqa/qualR/blob/master/tests/testthat)


#### **comments:**

<!-- record comments on testing suite here -->


All the tests passed. There are only a few tests. I recommend the authors to write more expectations with `expect_*()`, such as: expect the class of the result, the class of the columns in the dataset, ex: 
https://github.com/beatrizmilz/mananciais/blob/master/tests/testthat/test-atualizar_dados.R

There is a test are not testing anything related to the package: In `test-CetesbRetrieveParam.R`, the only expectation is `expect_equal(2 * 2, 4)`.  You can check here: https://github.com/quishqa/qualR/blob/dc15bd0d95366fad17258749890a0840b996b38b/tests/testthat/test-CetesbRetrieveParam.R#L15

There is no GitHub action to check the package consistently. If you want to know more, please check this link: 
https://github.com/r-lib/actions/tree/master/examples#example-workflows  

Since you are planning to submit to CRAN, the recommended action in the documentation can be generated with:

```
usethis::use_github_action("check-standard")
```


***
