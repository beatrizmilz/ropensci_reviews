---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(magrittr)
library(devtools)
```

# `qualR` - package review

## **Reviewer:** [\@beatrizmilz](https://github.com/beatrizmilz)

### Review Submitted: ....


Hi, here is my review: 

## Package Review

*Please check off boxes as applicable, and elaborate in comments below.  Your review is not limited to these topics, as described in the reviewer guide*

- **Briefly describe any working relationship you have (had) with the package authors.**

- [x] As the reviewer I confirm that there are no [conflicts of interest](https://devguide.ropensci.org/policies.html#coi) for me to review this work (if you are unsure whether you are in conflict, please speak to your editor _before_ starting your review).

#### Documentation

The package includes all the following forms of documentation:

- [ ] **A statement of need:** clearly stating problems the software is designed to solve and its target audience in README
- [ ] **Installation instructions:** for the development version of package and any non-standard dependencies in README
- [ ] **Vignette(s):** demonstrating major functionality that runs successfully locally
- [ ] **Function Documentation:** for all exported functions
- [ ] **Examples:** (that run successfully locally) for all exported functions
- [ ] **Community guidelines:** including contribution guidelines in the README or CONTRIBUTING, and DESCRIPTION with `URL`, `BugReports` and `Maintainer` (which may be autogenerated via `Authors@R`).

#### Functionality

- [ ] **Installation:** Installation succeeds as documented.
- [ ] **Functionality:** Any functional claims of the software been confirmed.
- [ ] **Performance:** Any performance claims of the software been confirmed.
- [ ] **Automated tests:** Unit tests cover essential functions of the package and a reasonable range of inputs and conditions. All tests pass on the local machine.
- [ ] **Packaging guidelines**: The package conforms to the rOpenSci packaging guidelines.

Estimated hours spent reviewing: 3h

- [x] Should the author(s) deem it appropriate, I agree to be acknowledged as a package reviewer ("rev" role) in the package DESCRIPTION file.

---

### Review Comments



----


<br>

This report contains documents associated with the review of **rOpenSci** submitted package:

### **`qualR`: ropensci/software-review**  issue [\#474](https://github.com/ropensci/software-review/issues/474).

<br>

## Package info

**Description:**

A package to download information from CETESB QUALAR and
    MonitorAr systems. It contains function to download different parameters, a set of
    criteria pollutants and the most frequent meteorological parameters used in
    air quality data analysis and air quality model evaluation.

**Author:** `r c(
    person(given = "Mario",
           family = "Gavidia-Calderón",
           role = c("aut", "cre"),
           email = "mario.calderon@iag.usp.br",
           comment = c(ORCID = "0000-0002-7371-1116")),
    person(given = "Maria de Fatima",
           family = "Andrade",
           role = c("ctb", "ths"),
           email = "maria.andrade@iag.usp.br",
           comment = c(ORCID = "0000-0001-5351-8311")),
    person(given = "Daniel",
           family = "Schuch",
           role = c("aut","ctb"),
           email = "d.schuch@northeastern.edu",
           comment = c(ORCID = "0000-0001-5977-4519")))`

**repo url:** <https://github.com/quishqa/qualR>

**website url:** <https://quishqa.github.io/qualR/>





## Review info


#### See [reviewer guidelines](https://ropensci.github.io/dev_guide/reviewerguide.html) for further information on the rOpenSci review process.

**key review checks:**

- Does the code comply with **general principles in the [Mozilla reviewing guide](https://mozillascience.github.io/codeReview/review.html)**?
- Does the package **comply with the [ROpenSci packaging guide](https://ropensci.github.io/dev_guide/building.html)**?
- Are there **improvements** that could be made to the **code style?**
- Is there **code duplication** in the package that should be reduced?
- Are there **user interface improvements** that could be made?
- Are there **performance improvements** that could be made?
- Is the [**documentation**](https://ropensci.github.io/dev_guide/building.html#documentation) (installation instructions/vignettes/examples/demos) **clear and sufficient**?

Please be respectful and kind to the authors in your reviews. The rOpenSci [code of conduct](https://ropensci.github.io/dev_guide/policies.html#code-of-conduct) is mandatory for everyone involved in our review process.



### session info


```{r sessionInfo, echo=TRUE}
sessionInfo()
```


```{r pkg_dir, echo=TRUE}
pkg_dir <- "/home/bea/GitHub/ropensci_reviews/qualR"
pkg_dir
```

## Test installation

### test local `qualR` install:

```{r test-local, eval=FALSE, include=TRUE}
install(pkg_dir, dependencies = T, build_vignettes = T)
```

```{r github-rm, eval=FALSE, include=TRUE}
remove.packages("qualR")
```


#### **comments:**

The local installation worked. ✨

***

### test install of `qualR` from GitHub with:

```{r test-github, eval=FALSE, include=TRUE}
devtools::install_github("quishqa/qualR", dependencies = T, build_vignettes = T)
```

#### **comments:**

 The installation via GitHub worked. ✨


## Check package integrity

### run checks on `qualR` source:

```{r check-checks, eval=FALSE, include=TRUE}
devtools::check(pkg_dir)
```


**Check results:** 

```
── R CMD check results ─────────────────────────────── qualR 0.9.5 ────
Duration: 1m 54s

> checking R/sysdata.rda ... OK
   WARNING
  ‘qpdf’ is needed for checks on size reduction of PDFs

> checking top-level files ... NOTE
  Non-standard files/directories found at top level:
    ‘CONTRIBUTING.md’ ‘LICENSE.md’ ‘README.Rmd’ ‘_pkgdown.yml’
    ‘appveyor.yml’ ‘codecov.yml’ ‘codemeta.json’ ‘data-raw’ ‘docs’
    ‘paper.bib’ ‘paper.md’ ‘pin_nox_lock20.png’ ‘rj_centro_2019.png’
    ‘usp_o3_aug21.png’

0 errors ✓ | 1 warning x | 1 note x
```


#### **comments:**

The check returned 1 note and 1 warning.

About the warning:

The warning of qpdf is related to an external program. In this Stackoverflow answer there is an explanation for it: https://stackoverflow.com/a/44649267


About the note:

There are some files that are not needed to the package be build, so it needs to be ignored on `.Rbuildignore` . One way to do that is to use `usethis::use_build_ignore("relative_path_to_the_file)`. But I do not recommend to use this function to all the files that the Check listed. There are some files that would be better located in other directories, not in the root of the package (such as the images and the files related to the paper being written about the package).  In this link, there is more information about the `.Rbuildignore` file: https://r-pkgs.org/package-structure-state.html#rbuildignore  
Ex:

```
> usethis::use_build_ignore("CONTRIBUTING.md")
✓ Setting active project to '/home/bea/GitHub/ropensci_reviews/qualR'
✓ Adding '^CONTRIBUTING\\.md$' to '.Rbuildignore'
```

***

### run tests on `qualR` source:

```{r check-tests, eval=FALSE, include=TRUE}
devtools::test(pkg_dir)
```


**Tests results:** 

```
══ Results ════════════════════════════════════════════════════════════
Duration: 71.1 s

[ FAIL 0 | WARN 0 | SKIP 0 | PASS 8 ]
```


#### **comments:**

All the tests passed. There are only a few tests. I recommend the authors to write more expectations with `expect_*()`. 

There is a test are not testing anything related to the package: In `test-CetesbRetrieveParam.R`, the only expectation is `expect_equal(2 * 2, 4)`.  You can check here: https://github.com/quishqa/qualR/blob/dc15bd0d95366fad17258749890a0840b996b38b/tests/testthat/test-CetesbRetrieveParam.R#L15




***


### check `qualR` for goodpractice:



```{r test-goodpractice, eval=FALSE, include=TRUE}
goodpractice::gp(pkg_dir)
```

```
── GP qualR ───────────────────────────────────────────────────────────

It is good practice to

  ✖ avoid calling setwd(), it changes the global
    environment. If you need it, consider using on.exit() to
    restore the working directory.

    tests/testthat/test-CetesbRetrieveParam.R:4:11
    tests/testthat/test-CetesbRetrieveParam.R:9:3
    tests/testthat/test-MonitorArRetrieve.R:4:11
    tests/testthat/test-MonitorArRetrieve.R:7:3

  ✖ fix this R CMD check NOTE: Note: found 40 marked
    UTF-8 strings
  ✖ fix this R CMD check WARNING: LaTeX errors when
    creating PDF version. This typically indicates Rd
    problems.
  ✖ fix this R CMD check ERROR: Re-running with no
    redirection of stdout/stderr. Hmm ... looks like a package
    Warning in texi2dvi(file = file, pdf = TRUE, clean =
    clean, quiet = quiet, : texi2dvi script/program not
    available, using emulation Error in texi2dvi(file = file,
    pdf = TRUE, clean = clean, quiet = quiet, : pdflatex is
    not available Warning in texi2dvi(file = file, pdf = TRUE,
    clean = clean, quiet = quiet, : texi2dvi script/program
    not available, using emulation Error in texi2dvi(file =
    file, pdf = TRUE, clean = clean, quiet = quiet, : pdflatex
    is not available Error in running tools::texi2pdf() You
    may want to clean up by 'rm -Rf
    /tmp/RtmpNm3vzd/Rd2pdf3bab53f279cd'
```




#### **comments:**

I recommend that the authors check if the `setwd()` is really necessary. The r-pkgs.org book says that `setwd()` should be used with caution. [Reference](https://r-pkgs.org/r.html#code-r-landscape).

***

## Check package metadata files

### inspect

- #### [README](https://github.com/quishqa/qualR)

[Reference](https://devguide.ropensci.org/building.html#readme)

- Please review the bagdes in the README.
    - There is two badges, the one for Travis has a broken link (404).
    - Add rOpenSci Review badge:   [![](https://badges.ropensci.org/474_status.svg)](https://github.com/ropensci/software-review/issues/474)

```
[![](https://badges.ropensci.org/474_status.svg)](https://github.com/ropensci/software-review/issues/474)
```

- Code of conduct: in the book, is recommended to use a code of conduct (CoC), and I did not find that information in the README. You can create that using `usethis`. But it is important to read this link:   https://devguide.ropensci.org/collaboration.html#coc-file  which says that if the package is transfered to rOpenSci GitHub organization, the CoC that needs to be used is the CoC that ropensci uses.  

```
> usethis::use_code_of_conduct("mario.calderon@iag.usp.br")
✓ Setting active project to '/home/bea/GitHub/ropensci_reviews/qualR'
✓ Writing 'CODE_OF_CONDUCT.md'
✓ Adding '^CODE_OF_CONDUCT\\.md$' to '.Rbuildignore'
Warning: pkgdown config does not specify the site's url, which is optional but recommended
• Don't forget to describe the code of conduct in your README:
  ## Code of Conduct
  
  Please note that the qualR project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
```


- #### [DESCRIPTION](https://github.com/quishqa/qualR/blob/master/DESCRIPTION)


- #### [NAMESPACE](https://github.com/quishqa/qualR/blob/master/NAMESPACE)



### spell check

```{r spell-check, eval=FALSE, include=TRUE}
devtools::spell_check(pkg_dir)
```

#### **comments:**

<!-- record comments on metadata files here -->

***

## Check documentation

online documentation: **<https://quishqa.github.io/qualR/>**

* Is the [documentation](https://ropensci.github.io/dev_guide/building.html#documentation) (installation instructions/vignettes/examples/demos) clear and sufficient?

### test `qualR` function help files:

```{r test-help, eval=FALSE, include=TRUE}
help(package = "qualR")
```

#### **comments:**

<!-- record comments on help files here -->

***

### test `qualR` vignettes:

```{r test-vignettes, eval=FALSE, include=TRUE}
vignette(package = "qualR")
```

#### **comments:**

<!-- record comments on vignettes here -->

***

## Test functionality:

- Are there **user interface improvements** that could be made?
- Are there **performance improvements** that could be made?

```{r free-style, eval=FALSE, include=TRUE}
library("qualR")
```

```{r parse-functions, eval=FALSE, include=TRUE}
exports <-ls("package:qualR")
exports
```

<!-- experiment with package functions -->

```{r exp-chunk}


```

#### **comments:**

<!-- record comments on package experimentation here -->

***

## Inspect code:

- Does the package **comply with the [ROpenSci packaging guide](https://ropensci.github.io/dev_guide/building.html)**?


- good [function & variable naming?](https://ropensci.github.io/dev_guide/building.html#function-and-argument-naming) 
    
Is recommended to choose a package names in lower case. [Reference](https://devguide.ropensci.org/building.html)

```{r pkg_name_available, eval=FALSE, include=TRUE}
available::available("qualR")
```

```
── qualR ──────────────────────────────────────────────────────────────
Name valid: ✔
Available on CRAN: ✔ 
Available on Bioconductor: ✔
Available on GitHub:  ✖ 
Abbreviations: http://www.abbreviations.com/qual
Wikipedia: https://en.wikipedia.org/wiki/qual
Wiktionary: https://en.wiktionary.org/wiki/qual
Urban Dictionary:
  [short] for [quality]
  http://qual.urbanup.com/410044
Sentiment:???
```

The name is available on CRAN! ⭐

It is also recommended to use snake_case for function names.  [Reference](https://devguide.ropensci.org/building.html#function-and-argument-naming)

    
- good [dependency management](https://ropensci.github.io/dev_guide/building.html#package-dependencies)?
    



- Are there **improvements** that could be made to the [**code style?**](https://ropensci.github.io/dev_guide/building.html#code-style)


- Is there **code duplication** in the package that should be reduced?

```{r inspect-code, eval=FALSE, include=TRUE}
pkgreviewr::pkgreview_print_source("qualR")
```
**\* might not be suitable for large packages with many exported functions**


<br>
<br>

#### **comments:**

<!-- record comments on package source code here -->


## Review test suite:

See guidance on [testing](https://ropensci.github.io/dev_guide/building.html#testing) for further details.

### test coverage

```{r pkg_coverage, eval=FALSE, include=TRUE}
covr::package_coverage(pkg_dir)

```

### inspect [tests](https://github.com/quishqa/qualR/blob/master/tests/testthat)


#### **comments:**

<!-- record comments on testing suite here -->


***



## Notes related to the book 'rOpenSci Packages: Development, Maintenance, and Peer Review'




## Datasets inside the package


The file `R/sysdata.rda` is storing some datasets of the package. Accordingly to [r-pkgs](https://r-pkgs.org/data.html?q=r/#data-sysdata), `R/sysdata.rda` should be used to internal datasets. Since the datasets are meant to be used by the users (some of them are on the README), it would be good to check if all the datasets that are meant to be used by the users are stored in the `data/` directory . 

To store the dataset in `data/`, you can use:

```
> usethis::use_data(cetesb)
✓ Saving 'cetesb' to 'data/cetesb.rda'
• Document your data (see 'https://r-pkgs.org/data.html')
```

## Console messages

It is not recommended to use `cat()` to communicate with the user of the functions. [Reference](https://devguide.ropensci.org/building.html#console-messages)

## CITATION file

The CITATION file exists. There are releases on GitHUb,  but I did not find any reference to  Zenodo.  [Reference](https://devguide.ropensci.org/building.html#citation-file). There is 0 results searching for qualR on Zenodo: https://zenodo.org/search?page=1&size=20&q=qualR . Read more how to do it and have a DOI for your package on [the GitHub documentation](https://docs.github.com/en/repositories/archiving-a-github-repository/referencing-and-citing-content).


-------



---

### Questions on the reviewer guide

- Does the code comply with general principles in the [Mozilla reviewing guide](https://mozillascience.github.io/codeReview/review.html)?

- Does the package comply with the [rOpenSci packaging guide](https://devguide.ropensci.org/building.html#building)?

- Are there improvements that could be made to the code style?

- Is there code duplication in the package that should be reduced?

- Are there user interface improvements that could be made?

- Are there performance improvements that could be made?

- Is the documentation (installation instructions/vignettes/examples/demos) 
clear and sufficient? Does it use the principle of multiple points of entry i.e. takes into account the fact that any piece of documentation may be the first encounter the user has with the package and/or the tool/data it wraps?

- Were functions and arguments named to work together to form a common, logical programming API that is easy to read, and autocomplete?

- If you have your own relevant data/problem, work through it with the package. You may find rough edges and use-cases the author didn’t think about.


---

## Checks

We encourage you to use automated tools to facilitate your reviewing. These include:

- Checking the package’s logs on its continuous integration services (GitHub Actions, Codecov, etc.)

- Running devtools::check() and devtools::test() on the package to find any errors that may be missed on the author’s system.


- Seeing whether tests’ skipping is justified (e.g. skip_on_cran() tests that do real API requests vs. skipping all tests on one operating system).
